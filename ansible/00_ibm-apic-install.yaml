- hosts: localhost
  #become: true
  #vars_files: {{ config_file }}
  #vars_files: ./configs/ibm-aiops-roks-all.yaml

  tasks:
  - name: 🚀 MAIN INSTALLATION LOOP - Install Module
    debug: 
      msg: 
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "                                                                                                                                                   "
      - "       🟢🟢🟢 IBM APIC - INSTALLATION -  CUSTOM INSTALLATION                                                                      "
      - "                                                                                                                                                   "
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      verbosity: 2


  - name: 🛠️  Config File Path
    debug:
      var: config_file_path
      verbosity: 2

  - name: 🛠️  Ansible check config file exists
    stat:
      path: "{{config_file_path}}"
    register: p

  - name: 🛠️  Ansible check config file exists
    debug:
      msg: "  ✅ Config File exists..."
      verbosity: 2
    when: p.stat.exists

  - name: 🛠️  Fail if not exists
    fail: msg="The specified config file {{config_file_path}} does not exist"
    when: p.stat.exists == False
      
  - name: 🛠️  Import Config File
    include_vars:
      file: "{{config_file_path}}"
      name: all_config

  # - name: 🟢🟢🟢  Show Config File
  #   debug:
  #     var: all_config
  #     verbosity: 2


  # - name: 🛠️  Get Global Config
  #   set_fact: global_config={{ all_config.global_config | default([]) }}
  # - name: 🟢🟢🟢  Show Global Config
  #   debug:
  #     var: global_config
  #     verbosity: 2


  # - name: 🛠️  Get Openshift Config
  #   set_fact: openshift_cluster={{ all_config.openshift | default([]) }}
  # - name: 🟢🟢🟢  Show Openshift Config
  #   debug:
  #     var: openshift_cluster
  #     verbosity: 2


  # Loop over all Clusters
  - name: ♻️  Deploy IBM AIOps Assets - Loop over Clusters
    include_role:
      name: ibm-apic-install
    loop: "{{ all_config.apic | default([]) }}"
    loop_control:
      loop_var: current_ibmaiops_cluster
   
